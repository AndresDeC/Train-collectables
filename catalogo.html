<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat√°logo Exclusivo - Trenes Store</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuraci√≥n para usar un buen fuente -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-dark': '#1e293b',
                        'secondary-light': '#94a3b8',
                    },
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .dark-mode {
            background-color: #0f172a;
            color: #f8fafc;
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background-color: #1e293b;
            border-bottom: 1px solid #334155;
        }
        .logo { font-size: 1.5rem; font-weight: bold; color: #3b82f6; }
        .btn-secondary { background-color: #475569; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; transition: background-color 0.3s; }
        .btn-secondary:hover { background-color: #64748b; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
        .grid-layout {
            display: grid;
            gap: 2rem;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }
    </style>
</head>
<body class="dark-mode">

    <!-- ----------------------------------------------------- -->
    <!-- 1. HEADER (Estructura de navegaci√≥n para usuarios logueados) -->
    <!-- ----------------------------------------------------- -->
    <header id="app-header">
        <div class="header-content">
            <h1 class="logo">Trenes Store</h1>
            <nav id="app-nav" class="flex space-x-4">
                <a href="index.html" class="text-white hover:text-blue-400 p-2">Inicio</a> 
                <a href="catalogo.html" class="text-blue-400 border-b-2 border-blue-400 p-2">Cat√°logo Exclusivo</a>
                <a href="perfil.html" class="text-white hover:text-blue-400 p-2">Mi Perfil</a>
            </nav>
        </div>
        <div id="auth-controls" class="user-controls flex items-center space-x-4">
            <span id="user-display" class="user-welcome hidden text-sm">Hola, Coleccionista</span>
            <button id="logout-btn" class="btn btn-secondary hidden">Cerrar Sesi√≥n</button>
        </div>
    </header>

    <!-- ----------------------------------------------------- -->
    <!-- 2. CONTENIDO PRINCIPAL (Cat√°logo) -->
    <!-- ----------------------------------------------------- -->
    <main id="main-content" class="container py-10">
        <h2 class="text-4xl font-extrabold mb-8 text-white border-b border-gray-700 pb-4">
            Cat√°logo Exclusivo Fleischmann üöÇ
        </h2>
        
        <!-- Contenedor del cat√°logo (Ser√° llenado por JavaScript) -->
        <div id="catalog-container" class="grid-layout">
            <p id="catalog-loading" class="text-lg text-gray-500 col-span-full text-center">
                Verificando autenticaci√≥n y cargando cat√°logo...
            </p>
            <!-- Las tarjetas de trenes ser√°n generadas aqu√≠ -->
        </div>
    </main>

    <!-- --------------------------------- -->
    <!-- FIREBASE AND JAVASCRIPT IMPORTS -->
    <!-- --------------------------------- -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <script>
        // Configuraci√≥n de Firebase - ¬°DEBE SER LA MISMA QUE index.html!
        const firebaseConfig = {
            apiKey: "AIzaSyB2OQlpj172YorIF2iB_Nvt2JB_W1U-G1A", 
            authDomain: "extension-84b64.firebaseapp.com",
            projectId: "extension-84b64",
        };
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Referencias del DOM para esta p√°gina
        const userDisplay = document.getElementById('user-display');
        const logoutBtn = document.getElementById('logout-btn');
        const catalogContainer = document.getElementById('catalog-container');
        const catalogLoading = document.getElementById('catalog-loading');


        // Datos simulados (Mock Data) de trenes Fleischmann
        const mockTrains = [
            { id: 1, name: "Locomotora Vapor BR 01", ref: "FLE-4101", scale: "H0", brand: "Fleischmann", price: "249.99‚Ç¨", desc: "Cl√°sica locomotora de vapor alemana con t√©nder, √©poca III.", image: "https://placehold.co/600x400/0f172a/94a3b8?text=BR+01" },
            { id: 2, name: "Vag√≥n de Carga Abierto Eanos", ref: "FLE-5221", scale: "N", brand: "Fleischmann", price: "45.50‚Ç¨", desc: "Vag√≥n de mercanc√≠as para transporte de carb√≥n o chatarra.", image: "https://placehold.co/600x400/0f172a/94a3b8?text=Vag√≥n+Eanos" },
            { id: 3, name: "Automotor ICE 4 (Set Base)", ref: "FLE-4460", scale: "H0", brand: "Fleischmann", price: "399.00‚Ç¨", desc: "Set inicial del tren de alta velocidad ICE 4, digitalizable.", image: "https://placehold.co/600x400/0f172a/94a3b8?text=Automotor+ICE+4" },
            { id: 4, name: "Locomotora El√©ctrica BR 103", ref: "FLE-4303", scale: "H0", brand: "Fleischmann", price: "295.75‚Ç¨", desc: "Emblem√°tica locomotora expr√©s de la Deutsche Bahn, librea roja.", image: "https://placehold.co/600x400/0f172a/94a3b8?text=BR+103" }
        ];

        /**
         * Renderiza las tarjetas del cat√°logo a partir de un array de trenes.
         */
        function renderCatalog(trains) {
            catalogLoading.classList.add('hidden'); // Oculta el mensaje de carga
            catalogContainer.innerHTML = ''; // Limpia el contenido

            if (trains.length === 0) {
                catalogContainer.innerHTML = '<p class="text-xl text-gray-400 col-span-full text-center">No se encontraron modelos en el cat√°logo.</p>';
                return;
            }

            trains.forEach(train => {
                const card = `
                    <div class="bg-primary-dark rounded-xl shadow-2xl overflow-hidden hover:shadow-blue-500/50 transition-shadow duration-300 transform hover:scale-[1.02]">
                        <!-- Imagen de Placeholder -->
                        <img src="${train.image}" alt="${train.name}" class="w-full h-48 object-cover object-center" onerror="this.onerror=null;this.src='https://placehold.co/600x400/0f172a/94a3b8?text=${train.brand}'">
                        
                        <div class="p-5">
                            <span class="inline-block bg-blue-500 text-xs font-semibold px-3 py-1 rounded-full text-white mb-2">${train.scale} - ${train.brand}</span>
                            <h3 class="text-xl font-bold text-white mb-1">${train.name}</h3>
                            <p class="text-sm text-secondary-light mb-3">Ref: ${train.ref}</p>
                            
                            <p class="text-base text-gray-300 mb-4 h-12 overflow-hidden">${train.desc}</p>

                            <div class="flex justify-between items-center mt-4">
                                <span class="text-2xl font-extrabold text-green-400">${train.price}</span>
                                <button data-train-id="${train.id}" class="btn-secondary bg-blue-600 hover:bg-blue-700">
                                    <span class="inline-block mr-1">üõí</span> A√±adir a Lista
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                catalogContainer.innerHTML += card;
            });
        }


        // L√ìGICA DE SEGURIDAD: Verifica la sesi√≥n y redirige si no hay usuario
        auth.onAuthStateChanged(user => {
            if (user) {
                // Usuario autenticado: Mostrar info de usuario
                userDisplay.classList.remove('hidden');
                logoutBtn.classList.remove('hidden');
                const displayName = user.displayName || user.email.split('@')[0];
                userDisplay.textContent = `Hola, ${displayName}`;

                // Cargar el prototipo del cat√°logo
                renderCatalog(mockTrains);

            } else {
                // Usuario NO autenticado: Redirigir a la p√°gina de inicio
                console.log('Acceso denegado. Redirigiendo a index.html');
                window.location.href = 'index.html';
            }
        });

        // Manejo del Logout (Redirige a index.html)
        logoutBtn.addEventListener('click', async () => {
            try {
                await auth.signOut();
                // onAuthStateChanged se encargar√° de redirigir a index.html
            } catch (error) {
                console.error("Error al cerrar sesi√≥n:", error);
            }
        });
    </script>
    
    <!-- Este archivo contendr√≠a la l√≥gica de Firestore real si existiera -->
    <!-- <script src="app/firestore.js" type="module"></script> --> 

</body>
</html>