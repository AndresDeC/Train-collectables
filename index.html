<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trenes Coleccionables - Tienda Exclusiva</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configuraci√≥n y Estilos Consolidados (CSS) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-dark': '#1e293b',
                        'secondary-light': '#94a3b8',
                        'accent-blue': '#3b82f6',
                    },
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .dark-mode {
            background-color: #0f172a;
            color: #f8fafc;
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem 1rem; }
        
        /* Header & Navegaci√≥n */
        #app-header {
            background-color: #1e293b;
            border-bottom: 1px solid #334155;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header-content { display: flex; align-items: center; }
        .logo { font-size: 1.75rem; font-weight: bold; color: #3b82f6; margin-right: 2rem; }
        #app-nav a {
            padding: 0.5rem 0.75rem;
            margin: 0 0.5rem;
            color: #f8fafc;
            transition: color 0.2s, border-bottom 0.2s;
        }
        #app-nav a.active, #app-nav a:hover { color: #3b82f6; border-bottom: 2px solid #3b82f6; }
        
        /* Botones Generales */
        .btn { padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; transition: background-color 0.3s; }
        .btn-primary { background-color: #3b82f6; color: white; }
        .btn-primary:hover { background-color: #2563eb; }
        .btn-secondary { background-color: #475569; color: white; }
        .btn-secondary:hover { background-color: #64748b; }
        .btn-link { background: none; color: #94a3b8; margin-top: 0.5rem; }
        .btn-link:hover { color: #f8fafc; }
        .btn-google { background-color: #db4437; color: white; }
        .btn-google:hover { background-color: #c0392b; }

        /* Vistas y Contenido */
        .view { display: none; }
        .view.active { display: block; }

        /* Auth/Lead Card */
        .auth-card {
            background-color: #1e293b;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            max-width: 400px;
            margin-top: 2rem;
        }
        .landing-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .lead-form-container { max-width: 500px; margin: 2rem auto; }
        .subtitle { color: #cbd5e1; }
        
        /* Formularios */
        input[type="email"], input[type="password"], input[type="text"], textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #475569;
            border-radius: 0.5rem;
            background-color: #334155;
            color: white;
            transition: border-color 0.2s;
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
        }

        /* Modal */
        .modal-backdrop {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            position: relative;
            padding: 2rem;
            min-width: 300px;
        }
        .error-msg {
            background-color: #f87171;
            color: white;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            text-align: center;
        }
        .success-msg {
            background-color: #4ade80;
            color: #166534;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            text-align: center;
        }
        .separator {
            text-align: center;
            margin: 1rem 0;
            color: #475569;
            position: relative;
        }
        .separator::before, .separator::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 40%;
            height: 1px;
            background: #475569;
        }
        .separator::before { left: 0; }
        .separator::after { right: 0; }
    </style>

</head>
<body class="dark-mode">

    <!-- ----------------------------------------------------- -->
    <!-- 1. HEADER (SIEMPRE VISIBLE - Botones din√°micos) -->
    <!-- ----------------------------------------------------- -->
    <header id="app-header">
        <div class="header-content">
            <h1 class="logo">Trenes Store</h1>
            <nav id="app-nav" class="flex space-x-2">
                <!-- La Landing Page es el Home. -->
                <a href="#home" class="nav-link active" data-view="landing-view">Inicio</a> 
                
                <!-- Links a archivos HTML externos, se hacen visibles al loguear. -->
                <a href="catalogo.html" class="nav-link hidden" id="nav-catalog">Cat√°logo Exclusivo</a>
                <a href="perfil.html" class="nav-link hidden" id="nav-profile">Mi Perfil</a>
            </nav>
        </div>
        <!-- üö® CONTROLES DE USUARIO üö® -->
        <div id="auth-controls" class="user-controls flex items-center space-x-4">
            <span id="user-display" class="user-welcome hidden text-sm">Hola, Coleccionista</span>
            <!-- Bot√≥n de Login/Registro (Visible si NO est√° logueado) -->
            <button id="show-login-btn" class="btn btn-primary">Entrar / Registrarse</button>
            <!-- Bot√≥n de Logout (Visible si S√ç est√° logueado) -->
            <button id="logout-btn" class="btn btn-secondary hidden">Cerrar Sesi√≥n</button>
        </div>
    </header>

    <!-- ----------------------------------------------------- -->
    <!-- 2. CONTENIDO PRINCIPAL (Landing Page √önica en index.html) -->
    <!-- ----------------------------------------------------- -->
    <main id="main-content" class="container">

        <!-- VISTA 0: LANDING PAGE (P√öBLICA Y ACTIVA POR DEFECTO) -->
        <section id="landing-view" class="view active">
            <div class="landing-content">
                <h1 class="text-4xl font-extrabold mb-2">Bienvenido a Trenes Store</h1>
                <p class="subtitle text-xl mb-6 text-gray-400">La colecci√≥n m√°s selecta de modelos de trenes a escala. Reg√≠strate o inicia sesi√≥n para acceder al cat√°logo completo.</p>
                
                <!-- Formulario de Captura de Leads (P√∫blico) -->
                <div class="lead-form-container auth-card p-6">
                    <h3 class="text-2xl mb-3">¬øInteresado en novedades y ofertas?</h3>
                    <p class="mb-4 text-gray-400">D√©janos tu correo y te avisaremos sobre las pr√≥ximas colecciones.</p>
                    
                    <!-- üö® CONFIGURACI√ìN FORMSUBMIT üö® -->
                    <form 
                        id="public-interest-form" 
                        class="auth-form space-y-3"
                        action="https://formsubmit.co/adc.030328@gmail.com"
                        method="POST"
                    >
                        <!-- Campo oculto para deshabilitar el captcha (recomendado) -->
                        <input type="hidden" name="_captcha" value="false">
                        
                        <!-- CAMPO DE AUTO-RESPUESTA: Env√≠a un mensaje de agradecimiento al email del cliente -->
                        <input type="hidden" name="_autoresponse" value="¬°Gracias por tu inter√©s en Trenes Store! Hemos recibido tu solicitud. Un coleccionista experto se comunicar√° contigo pronto para compartir nuestro cat√°logo exclusivo.">
                        
                        <!-- Campo Nombre (Importante: tiene atributo name="name") -->
                        <input 
                            type="text" 
                            id="public-name-input" 
                            name="name" 
                            placeholder="Tu Nombre" 
                            required
                        >
                        
                        <!-- Campo Email (Importante: tiene atributo name="email") -->
                        <input 
                            type="email" 
                            id="public-email-input" 
                            name="email" 
                            placeholder="Tu Correo Electr√≥nico" 
                            required
                        >
                        
                        <!-- CAMPO: TEXTAREA PARA EL MENSAJE -->
                        <textarea 
                            id="public-message-input" 
                            name="message" 
                            placeholder="Escribe tu mensaje o pregunta aqu√≠ (opcional)" 
                            rows="4"
                            class="p-3 border border-gray-600 rounded-lg bg-gray-700 text-white focus:ring-blue-500 focus:border-blue-500"
                        ></textarea>


                        <button type="submit" class="btn btn-primary w-full mt-2">¬°Me Interesa!</button>
                        <div id="public-form-message" class="success-msg hidden"></div>
                    </form>
                </div>
            </div>
        </section>

        <!-- VISTAS PROTEGIDAS ELIMINADAS: Ahora van en catalogo.html y perfil.html -->

    </main>

    <!-- 3. MODAL DE LOGIN/REGISTRO -->
    <div id="login-modal-container" class="modal-backdrop hidden">
        <div id="login-modal" class="modal-content auth-card">
            <!-- Bot√≥n de cierre -->
            <button class="close-btn absolute top-3 right-3 text-2xl text-gray-400 hover:text-white" id="close-login-modal">&times;</button>
            <h3 id="auth-title" class="text-2xl font-semibold text-center mb-4 text-white">Inicia Sesi√≥n</h3>

            <div id="error-message" class="error-msg hidden"></div>

            <form id="auth-form" class="auth-form space-y-3">
                <input type="email" id="email-input" placeholder="Correo Electr√≥nico" required>
                <input type="password" id="password-input" placeholder="Contrase√±a" required>


                <button type="submit" id="auth-submit-btn" class="btn btn-primary w-full mt-4">Iniciar Sesi√≥n</button>
            </form>

            <button id="toggle-mode-btn" class="btn btn-link text-center w-full">¬øNo tienes cuenta? Reg√≠strate</button>
            <p class="separator">O</p>
            <button id="anonymous-login-btn" class="btn btn-secondary w-full">
                Entrar como An√≥nimo
            </button>
        </div>
    </div>

    <!-- --------------------------------- -->
    <!-- FIREBASE AND JAVASCRIPT LOGIC -->
    <!-- --------------------------------- -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <script>
        // === 1. FIREBASE INITIALIZATION ===
        const firebaseConfig = {
            apiKey: "AIzaSyB2OQlpj172YorIF2iB_Nvt2JB_W1U-G1A", 
            authDomain: "extension-84b64.firebaseapp.com",
            projectId: "extension-84b64",
        };
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // === 2. DOM REFERENCES ===
        const modalContainer = document.getElementById('login-modal-container');
        const showLoginBtn = document.getElementById('show-login-btn');
        const closeLoginModalBtn = document.getElementById('close-login-modal');
        const logoutBtn = document.getElementById('logout-btn');
        const authForm = document.getElementById('auth-form');
        const authTitle = document.getElementById('auth-title');
        const authSubmitBtn = document.getElementById('auth-submit-btn');
        const toggleModeBtn = document.getElementById('toggle-mode-btn');
        const anonymousLoginBtn = document.getElementById('anonymous-login-btn');
        const emailInput = document.getElementById('email-input');
        const passwordInput = document.getElementById('password-input');
        const errorMessage = document.getElementById('error-message');
        const userDisplay = document.getElementById('user-display');
        const navCatalog = document.getElementById('nav-catalog');
        const navProfile = document.getElementById('nav-profile');
        
        let isLoginMode = true; // Estado para alternar entre Login y Registro

        // === 3. AUTHENTICATION LOGIC ===

        /** Muestra un error en el modal */
        function displayError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
            setTimeout(() => errorMessage.classList.add('hidden'), 5000);
        }
        
        /** Abre el modal de login/registro */
        showLoginBtn.addEventListener('click', () => {
            modalContainer.classList.remove('hidden');
            errorMessage.classList.add('hidden');
        });

        /** Cierra el modal */
        closeLoginModalBtn.addEventListener('click', () => {
            modalContainer.classList.add('hidden');
        });

        /** Alterna entre modo Login y Registro */
        toggleModeBtn.addEventListener('click', () => {
            isLoginMode = !isLoginMode;
            if (isLoginMode) {
                authTitle.textContent = 'Inicia Sesi√≥n';
                authSubmitBtn.textContent = 'Iniciar Sesi√≥n';
                toggleModeBtn.textContent = '¬øNo tienes cuenta? Reg√≠strate';
            } else {
                authTitle.textContent = 'Reg√≠strate (Nuevo Usuario)';
                authSubmitBtn.textContent = 'Crear Cuenta';
                toggleModeBtn.textContent = '¬øYa tienes cuenta? Inicia Sesi√≥n';
            }
        });

        /** Maneja el formulario de Login/Registro */
        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            errorMessage.classList.add('hidden');

            const email = emailInput.value;
            const password = passwordInput.value;

            try {
                if (isLoginMode) {
                    // MODO LOGIN
                    await auth.signInWithEmailAndPassword(email, password);
                } else {
                    // MODO REGISTRO
                    await auth.createUserWithEmailAndPassword(email, password);
                }
                modalContainer.classList.add('hidden'); // Cierra el modal al tener √©xito

            } catch (error) {
                console.error("Auth Error:", error);
                let msg = "Error de autenticaci√≥n. Int√©ntalo de nuevo.";
                if (error.code === 'auth/wrong-password') {
                    msg = "Contrase√±a incorrecta.";
                } else if (error.code === 'auth/user-not-found') {
                    msg = "Usuario no encontrado.";
                } else if (error.code === 'auth/email-already-in-use') {
                    msg = "El correo ya est√° registrado.";
                } else if (error.code === 'auth/invalid-email') {
                    msg = "Formato de correo inv√°lido.";
                } else if (error.code === 'auth/weak-password') {
                    msg = "La contrase√±a debe tener al menos 6 caracteres.";
                }
                displayError(msg);
            }
        });

        /** Maneja el login an√≥nimo (Para pruebas de rutas protegidas) */
        anonymousLoginBtn.addEventListener('click', async () => {
            try {
                await auth.signInAnonymously();
                modalContainer.classList.add('hidden');
            } catch (error) {
                console.error("Anonymous Auth Error:", error);
                displayError("No se pudo iniciar sesi√≥n an√≥nimamente.");
            }
        });

        /** Maneja el logout */
        logoutBtn.addEventListener('click', async () => {
            try {
                await auth.signOut();
            } catch (error) {
                console.error("Error al cerrar sesi√≥n:", error);
            }
        });


        // === 4. AUTH STATE OBSERVER (El coraz√≥n de la din√°mica de la app) ===
        auth.onAuthStateChanged(user => {
            if (user) {
                // USUARIO LOGUEADO
                
                // 1. Mostrar saludo
                const displayName = user.displayName || user.email || "Coleccionista An√≥nimo";
                userDisplay.textContent = `Hola, ${displayName.split('@')[0]}`;
                userDisplay.classList.remove('hidden');

                // 2. Mostrar/Ocultar botones de navegaci√≥n y auth
                showLoginBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
                navCatalog.classList.remove('hidden');
                navProfile.classList.remove('hidden');

            } else {
                // USUARIO DESLOGUEADO (O an√≥nimo cerrado)

                // 1. Ocultar saludo
                userDisplay.classList.add('hidden');

                // 2. Mostrar/Ocultar botones de navegaci√≥n y auth
                showLoginBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
                navCatalog.classList.add('hidden');
                navProfile.classList.add('hidden');
            }
        });

    </script>
    
    <!-- Scripts externos eliminados para consolidaci√≥n -->

</body>
</html>